import { useRef, useState } from "react"
import { usePhone } from "../../../store/store";
import { CSSTransition } from "react-transition-group";
import Title from "../../components/Title";
import { fetchNui } from "../../../hooks/fetchNui";

export default function Message() {
    const nodeRef = useRef(null);
    const { location, setLocation } = usePhone();
    const [messageStats, setMessageStats] = useState<{
        success: boolean,
        stats: {
            allMessages: number, 
            knownMessages: number, 
            unknownMessages: number, 
            unreadMessages: number, 
            recentlyDeleted: number
        }
    }>({
        success: false,
        stats: {
            allMessages: 0, 
            knownMessages: 0, 
            unknownMessages: 0, 
            unreadMessages: 0, 
            recentlyDeleted: 0
        }
    });

    return (
        <CSSTransition nodeRef={nodeRef} in={location.app === 'message' && location.page.messages === ''} timeout={450} classNames="enterandexitfromtop" unmountOnExit mountOnEnter onEntering={async () => {
            const res: any = await fetchNui('getMessagesStats', "Ok");
            const parsedData: {
                success: boolean,
                stats: {
                    allMessages: number, 
                    knownMessages: number, 
                    unknownMessages: number, 
                    unreadMessages: number, 
                    recentlyDeleted: number
                }
            } = JSON.parse(res);
            setMessageStats(parsedData);
        }}>
            <div ref={nodeRef} style={{
                backgroundColor: '#0E0E0E',
                width: '100%',
                height: '100%',
                zIndex: 10,
                position: 'absolute',
                display: 'flex',
                flexDirection: 'column',
                alignItems: 'center',
            }} className="message">
                <div style={{
                    marginTop: '3.4vw',
                    marginLeft: '0vw',
                }}>
                    <Title title="Messages" />
                </div>
                <div style={{
                    display: 'flex',
                    width: '14.895833333333334vw',
                    height: '7.3vw',
                    padding: '0.3645833333333333vw 0px',
                    flexDirection: 'column',
                    alignItems: 'flex-start',
                    gap: '0.46875vw',
                    flexShrink: 0,
                    marginTop: '0.9375vw',
                    borderRadius: '0.3125vw',
                    background: '#1C1C1E'
                }}>
                    <div className="Xsadsasa">
                        <svg width="1.3541666666666667vw" height="1.1458333333333333vw" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M2.49066 14.3517C2.49066 14.3517 3.28285 14.5532 4.24493 14.4434C4.85175 14.3742 5.52615 14.1811 6.11199 13.7354C6.54589 13.8274 8.19521 14.0594 9.36564 14.191C9.86982 14.2476 10.2851 14.2856 10.4762 14.2857C10.4704 14.2718 10.4646 14.2579 10.4589 14.244C11.3638 15.1132 12.6583 15.6574 14.0952 15.6574C14.4879 15.6572 14.8796 15.6152 15.2639 15.5321C15.4334 15.6637 15.6149 15.7604 15.7984 15.8305C16.6304 16.1485 17.5057 15.9214 17.5057 15.9214C17.4254 15.8942 17.3476 15.8614 17.2726 15.8234C16.9573 15.6635 16.6931 15.411 16.5152 15.0955C16.5776 15.0643 16.6391 15.0319 16.6998 14.9985C16.787 14.9503 16.8725 14.8998 16.956 14.8471C18.2199 14.0494 19.0476 12.7395 19.0476 11.2573C19.0476 9.42693 17.789 7.85771 15.9998 7.19453C15.9976 6.87191 15.9701 6.55258 15.9191 6.23829C15.365 2.82169 12.0287 0 7.99999 0C3.58399 0 0 3.119 0 6.96684C0 9.25274 1.26832 11.2796 3.22086 12.5506C3.4976 12.7308 3.78809 12.8957 4.09066 13.0441C4.00256 13.1973 3.90133 13.3411 3.78861 13.4742C3.67925 13.6033 3.55909 13.7224 3.42962 13.83C3.15396 14.0593 2.83613 14.2371 2.49066 14.3517ZM9.90094 8.40441C8.84668 9.65949 8.59938 11.2987 9.04719 13.1469C8.84654 13.1227 8.63466 13.0962 8.41752 13.0681C7.47389 12.9458 6.58319 12.813 6.31931 12.7571L5.87115 12.6622L5.50655 12.9395C5.40526 13.0166 5.29861 13.0836 5.18806 13.1417L5.49004 12.6165L4.53091 12.1462C2.37024 11.0868 1 9.12684 1 6.96684C1 3.79685 4.00174 1 7.99999 1C11.5503 1 14.378 3.44563 14.9099 6.2783C12.7904 6.43991 10.999 7.09721 9.90094 8.40441ZM15.5086 14.4561L15.528 14.4712L16.0679 14.2012C17.2955 13.587 18.0476 12.4666 18.0476 11.2573C18.0476 9.48739 16.3913 7.85715 14.0952 7.85715C11.7991 7.85715 10.1428 9.48739 10.1428 11.2573C10.1428 13.0271 11.7991 14.6574 14.0952 14.6574C14.4168 14.6572 14.7377 14.6228 15.0526 14.5547L15.5086 14.4561Z" fill="#0A84FF" />
                        </svg>
                        <div className="XSADAAA">
                            <div className="text">All messages</div>
                            <div className="readsada" style={{
                                cursor: 'pointer'
                            }} onClick={() => {
                                const data = {
                                    ...location.page,
                                    messages: 'all'
                                }
                                setLocation({
                                    app: 'message',
                                    page: data
                                })
                            }}>
                                <div className="textX">{messageStats.stats.allMessages}</div>
                                <svg width="0.46875vw" height="0.6770833333333334vw" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M1 0.5L4.58662 4.53495C4.82237 4.80017 4.82237 5.19983 4.58662 5.46505L1 9.5" stroke="white" stroke-opacity="0.4" stroke-width="0.7" stroke-linecap="round" />
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div className="divider" style={{ marginTop: '0', width: '90%', marginLeft: '0.8vw' }}></div>
                    <div className="Xsadsasa">
                        <svg width="1.1458333333333333vw" height="1.1458333333333333vw" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 9.14286C9.57799 9.14286 10.8571 7.86367 10.8571 6.28571C10.8571 4.70776 9.57799 3.42857 8 3.42857C6.42201 3.42857 5.14286 4.70776 5.14286 6.28571C5.14286 7.86367 6.42201 9.14286 8 9.14286Z" fill="#0A84FF" />
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M0 8C0 9.69877 0.529576 11.2738 1.43248 12.5692L1.42857 12.5714C1.4555 12.6074 1.4827 12.643 1.50991 12.6784C2.25056 13.7041 3.22838 14.5473 4.363 15.1274C5.45285 15.6846 6.68722 15.9992 7.99512 16H8.00167C11.1437 15.9994 13.4289 14.2854 14.5714 12.5713L14.5677 12.5692C15.4706 11.2738 16 9.69873 16 8C16 3.58172 12.4182 0 8 0C3.58175 0 0 3.58172 0 8ZM8 10.2857C6.63337 10.2857 5.52818 10.2857 1.93262 12.2871C1.07533 11.0759 0.571429 9.59678 0.571429 8C0.571429 3.89732 3.89732 0.571429 8 0.571429C12.1027 0.571429 15.4286 3.89732 15.4286 8C15.4286 9.59675 14.9248 11.0759 14.0675 12.287C10.472 10.2857 9.36663 10.2857 8 10.2857Z" fill="#0A84FF" />
                        </svg>
                        <div className="XSADAAA">
                            <div className="text" style={{ width: '6.2vw' }}>Known messages</div>
                            <div className="readsada" style={{
                                cursor: 'pointer'
                            }} onClick={() => {
                                const data = {
                                    ...location.page,
                                    messages: 'all'
                                }
                                setLocation({
                                    app: 'message',
                                    page: data
                                })
                            }}>
                                <div className="textX">{messageStats.stats.knownMessages}</div>
                                <svg width="0.46875vw" height="0.6770833333333334vw" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M1 0.5L4.58662 4.53495C4.82237 4.80017 4.82237 5.19983 4.58662 5.46505L1 9.5" stroke="white" stroke-opacity="0.4" stroke-width="0.7" stroke-linecap="round" />
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div className="divider" style={{ marginTop: '0', width: '90%', marginLeft: '0.8vw' }}></div>
                    <div className="Xsadsasa">
                        <svg width="1.1458333333333333vw" height="1.1458333333333333vw" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 9.14286C10.578 9.14286 11.8571 7.86367 11.8571 6.28571C11.8571 4.70776 10.578 3.42857 9 3.42857C7.42201 3.42857 6.14286 4.70776 6.14286 6.28571C6.14286 7.86367 7.42201 9.14286 9 9.14286Z" fill="#0A84FF" />
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M1 8C1 9.69877 1.52958 11.2738 2.43248 12.5692L2.42857 12.5714C2.4555 12.6074 2.4827 12.643 2.50991 12.6784C3.25056 13.7041 4.22838 14.5473 5.363 15.1274C6.45285 15.6846 7.68722 15.9992 8.99512 16H9.00167C12.1437 15.9994 14.4289 14.2854 15.5714 12.5713L15.5677 12.5692C16.4706 11.2738 17 9.69873 17 8C17 3.58172 13.4182 0 9 0C4.58175 0 1 3.58172 1 8ZM9 10.2857C7.63337 10.2857 6.52818 10.2857 2.93262 12.2871C2.07533 11.0759 1.57143 9.59678 1.57143 8C1.57143 3.89732 4.89732 0.571429 9 0.571429C13.1027 0.571429 16.4286 3.89732 16.4286 8C16.4286 9.59675 15.9248 11.0759 15.0675 12.287C11.472 10.2857 10.3666 10.2857 9 10.2857Z" fill="#0A84FF" />
                            <circle cx="3" cy="13" r="2.75" fill="#0A84FF" stroke="#1C1C1E" stroke-width="0.5" />
                            <path d="M1.86963 12.4219C1.8916 11.8677 2.27002 11.4478 2.97803 11.4478C3.62256 11.4478 4.05713 11.8311 4.05713 12.3535C4.05713 12.7319 3.8667 12.998 3.54443 13.1909C3.22949 13.3765 3.13916 13.5059 3.13916 13.7573V13.9062H2.63379L2.63135 13.7109C2.61914 13.3667 2.76807 13.147 3.10254 12.9468C3.39795 12.7686 3.50293 12.627 3.50293 12.3755C3.50293 12.0996 3.28564 11.897 2.95117 11.897C2.61426 11.897 2.39697 12.0996 2.375 12.4219H1.86963ZM2.89014 15.0366C2.71191 15.0366 2.57031 14.8999 2.57031 14.7217C2.57031 14.5435 2.71191 14.4067 2.89014 14.4067C3.07324 14.4067 3.2124 14.5435 3.2124 14.7217C3.2124 14.8999 3.07324 15.0366 2.89014 15.0366Z" fill="#1C1C1E" />
                        </svg>
                        <div className="XSADAAA">
                            <div className="text" style={{ width: '7vw' }}>Unknown messages</div>
                            <div className="readsada" style={{
                                cursor: 'pointer'
                            }} onClick={() => {
                                const data = {
                                    ...location.page,
                                    messages: 'all'
                                }
                                setLocation({
                                    app: 'message',
                                    page: data
                                })
                            }}>
                                <div className="textX">{messageStats.stats.unknownMessages}</div>
                                <svg width="0.46875vw" height="0.6770833333333334vw" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M1 0.5L4.58662 4.53495C4.82237 4.80017 4.82237 5.19983 4.58662 5.46505L1 9.5" stroke="white" stroke-opacity="0.4" stroke-width="0.7" stroke-linecap="round" />
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div className="divider" style={{ marginTop: '0', width: '90%', marginLeft: '0.8vw' }}></div>
                    <div className="Xsadsasa">
                        <svg width="1.1458333333333333vw" height="1.1458333333333333vw" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M9.94661 1.35057e-07H10.002C10.6701 1.35057e-07 11.2912 1.01363e-07 11.8664 0.00487452C12.2517 0.00813964 12.5614 0.323144 12.5581 0.708437C12.5549 1.09374 12.2398 1.40344 11.8545 1.40018C11.2859 1.39536 10.6704 1.39535 10 1.39535C7.7877 1.39535 6.19866 1.39683 4.98938 1.55941C3.80016 1.7193 3.08321 2.02339 2.5533 2.5533C2.02339 3.08321 1.7193 3.80016 1.55941 4.98938C1.39683 6.19866 1.39535 7.7877 1.39535 10C1.39535 10.0783 1.39535 10.1558 1.39536 10.2326H3.63745C3.67959 10.2326 3.72122 10.2326 3.76236 10.2325C4.48098 10.2317 5.0501 10.2312 5.56208 10.4666C6.07406 10.702 6.44399 11.1346 6.91108 11.6807C6.93782 11.7119 6.96488 11.7435 6.99231 11.7755L7.5555 12.4327C8.14502 13.1204 8.31051 13.2905 8.5093 13.382C8.70819 13.4735 8.94502 13.4884 9.85088 13.4884H10.1491C11.055 13.4884 11.2918 13.4735 11.4907 13.382C11.6895 13.2905 11.855 13.1204 12.4445 12.4327L13.0077 11.7755C13.0352 11.7435 13.0621 11.7119 13.0889 11.6807C13.556 11.1346 13.926 10.702 14.438 10.4666C14.9499 10.2312 15.5191 10.2317 16.2377 10.2325C16.2788 10.2326 16.3204 10.2326 16.3625 10.2326H18.6047C18.6047 10.1558 18.6047 10.0783 18.6047 10C18.6047 9.32958 18.6047 8.71414 18.5998 8.14549C18.5966 7.76015 18.9062 7.44515 19.2915 7.44189C19.6768 7.43862 19.9918 7.74832 19.9952 8.13362C20 8.70874 20 9.32967 20 9.99786V10.0534C20 10.3459 20 10.6297 19.9995 10.9052C19.9998 10.9135 20 10.9219 20 10.9302C20 10.9394 19.9998 10.9486 19.9994 10.9578C19.9963 12.6806 19.9744 14.0738 19.8235 15.1966C19.6428 16.5405 19.2658 17.601 18.4334 18.4334C17.601 19.2658 16.5405 19.6428 15.1966 19.8235C13.8835 20 12.2007 20 10.0534 20H9.94661C7.79928 20 6.11646 20 4.80345 19.8235C3.45951 19.6428 2.39902 19.2658 1.56664 18.4334C0.734261 17.601 0.3572 16.5405 0.176512 15.1966C0.0255536 14.0738 0.00369321 12.6806 0.000530422 10.9577C0.000176934 10.9486 1.35057e-07 10.9394 1.35057e-07 10.9302C1.35057e-07 10.9219 0.000149012 10.9135 0.000437384 10.9052C1.74352e-07 10.6297 1.35057e-07 10.3459 1.35057e-07 10.0534V9.94661C-9.16727e-06 7.79928 -1.85052e-05 6.11646 0.176512 4.80345C0.3572 3.45951 0.734261 2.39902 1.56664 1.56664C2.39902 0.734261 3.45951 0.3572 4.80345 0.176512C6.11646 -1.85052e-05 7.79928 -9.16727e-06 9.94661 1.35057e-07ZM1.3986 11.6279C1.40739 13.0257 1.4398 14.1209 1.55941 15.0106C1.7193 16.1998 2.02339 16.9167 2.5533 17.4467C3.08321 17.9767 3.80016 18.2807 4.98938 18.4406C6.19866 18.6032 7.7877 18.6047 10 18.6047C12.2123 18.6047 13.8013 18.6032 15.0106 18.4406C16.1998 18.2807 16.9167 17.9767 17.4467 17.4467C17.9767 16.9167 18.2807 16.1998 18.4406 15.0106C18.5602 14.1209 18.5927 13.0257 18.6014 11.6279H16.3625C15.4567 11.6279 15.2198 11.6428 15.0209 11.7343C14.8221 11.8258 14.6567 11.9959 14.0672 12.6836L13.5039 13.3407C13.4765 13.3727 13.4495 13.4044 13.4227 13.4356C12.9556 13.9817 12.5857 14.4142 12.0737 14.6497C11.5618 14.8851 10.9926 14.8846 10.274 14.8838C10.2328 14.8837 10.1913 14.8837 10.1491 14.8837H9.85088C9.80874 14.8837 9.76716 14.8837 9.72605 14.8838C9.00744 14.8846 8.43823 14.8851 7.92629 14.6497C7.41432 14.4142 7.04438 13.9817 6.57729 13.4356C6.55055 13.4044 6.52349 13.3727 6.49607 13.3407L5.93287 12.6836C5.34335 11.9959 5.17788 11.8258 4.97902 11.7343C4.78018 11.6428 4.54332 11.6279 3.63745 11.6279H1.3986ZM16.5116 1.39535C15.3557 1.39535 14.4186 2.33243 14.4186 3.48837C14.4186 4.64432 15.3557 5.5814 16.5116 5.5814C17.6675 5.5814 18.6047 4.64432 18.6047 3.48837C18.6047 2.33243 17.6675 1.39535 16.5116 1.39535ZM13.0233 3.48837C13.0233 1.5618 14.585 1.35057e-07 16.5116 1.35057e-07C18.4382 1.35057e-07 20 1.5618 20 3.48837C20 5.41495 18.4382 6.97674 16.5116 6.97674C14.585 6.97674 13.0233 5.41495 13.0233 3.48837Z" fill="#0A84FF" />
                        </svg>
                        <div className="XSADAAA">
                            <div className="text" style={{ width: '6.35vw' }}>Unread messages</div>
                            <div className="readsada" style={{
                                cursor: 'pointer'
                            }} onClick={() => {
                                const data = {
                                    ...location.page,
                                    messages: 'all'
                                }
                                setLocation({
                                    app: 'message',
                                    page: data
                                })
                            }}>
                                <div className="textX">{messageStats.stats.unreadMessages}</div>
                                <svg width="0.46875vw" height="0.6770833333333334vw" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M1 0.5L4.58662 4.53495C4.82237 4.80017 4.82237 5.19983 4.58662 5.46505L1 9.5" stroke="white" stroke-opacity="0.4" stroke-width="0.7" stroke-linecap="round" />
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
                <div style={{
                    display: 'flex',
                    width: '14.895833333333334vw',
                    height: '1.7vw',
                    padding: '0.3645833333333333vw 0px',
                    flexDirection: 'column',
                    alignItems: 'flex-start',
                    gap: '0.46875vw',
                    flexShrink: 0,
                    marginTop: '0.9375vw',
                    borderRadius: '0.3125vw',
                    background: '#1C1C1E'
                }}>
                    <div className="Xsadsasa">
                        <svg width="1.0416666666666667vw" height="1.0416666666666667vw" viewBox="0 0 12 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0.354016 2.82076H1.45327L1.96498 11.8356C1.97526 12.023 2.13083 12.1697 2.31864 12.1697H9.02793C9.21574 12.1697 9.37131 12.0227 9.38159 11.8352L9.88515 2.82076H10.9851C11.1811 2.82076 11.3395 2.662 11.3395 2.46639C11.3395 2.27077 11.1811 2.11202 10.9851 2.11202H9.65942C9.63993 2.11202 9.62292 2.12017 9.60413 2.123C9.58571 2.12017 9.5687 2.11202 9.54992 2.11202H7.69089V1.18463C7.69089 0.989019 7.53249 0.830261 7.33652 0.830261H4.00225C3.80629 0.830261 3.64788 0.989019 3.64788 1.18463V2.11202H1.78815C1.77185 2.11202 1.75732 2.11946 1.74137 2.12159C1.72507 2.1191 1.71054 2.11202 1.69353 2.11202H0.35437C0.158403 2.11202 0 2.27077 0 2.46639C0 2.662 0.158049 2.82076 0.354016 2.82076ZM4.35662 1.539H6.98215V2.11202H4.35662V1.539ZM9.17535 2.82076L8.69269 11.4614H2.65352L2.16307 2.82076H9.17535Z" fill="#0A84FF" />
                            <path d="M3.9147 10.7969C3.92179 10.7969 3.92816 10.7969 3.93525 10.7966C4.13086 10.7856 4.28005 10.618 4.26871 10.4227L3.89592 3.85446C3.88493 3.65885 3.71271 3.51178 3.52206 3.52064C3.32644 3.53163 3.17725 3.69925 3.18859 3.8945L3.56139 10.4628C3.57202 10.6513 3.7283 10.7969 3.9147 10.7969Z" fill="#0A84FF" />
                            <path d="M7.39116 10.7966C7.39825 10.7969 7.40463 10.7969 7.41171 10.7969C7.59811 10.7969 7.75439 10.6513 7.76502 10.4628L8.13782 3.89451C8.1488 3.69925 7.99961 3.53163 7.80436 3.52065C7.61193 3.5125 7.44184 3.65885 7.4305 3.85447L7.0577 10.4227C7.04671 10.618 7.1959 10.7856 7.39116 10.7966Z" fill="#0A84FF" />
                            <path d="M5.66956 10.7969C5.86552 10.7969 6.02393 10.6382 6.02393 10.4426V3.87433C6.02393 3.67872 5.86552 3.51996 5.66956 3.51996C5.47359 3.51996 5.31519 3.67872 5.31519 3.87433V10.4426C5.31519 10.6382 5.47359 10.7969 5.66956 10.7969Z" fill="#0A84FF" />
                        </svg>
                        <div className="XSADAAA">
                            <div className="text" style={{ width: '5.6vw' }}>Recently Deleted</div>
                            <svg width="0.46875vw" height="0.6770833333333334vw" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1 0.5L4.58662 4.53495C4.82237 4.80017 4.82237 5.19983 4.58662 5.46505L1 9.5" stroke="white" stroke-opacity="0.4" stroke-width="0.7" stroke-linecap="round" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </CSSTransition>
    )
}